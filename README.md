# 浙工大场馆自动预约程序

## 功能说明

本程序可以自动完成浙工大场馆预约的整个流程：

1. 自动登录系统
2. 选择屏峰校区室外网球场
3. 选择明天的日期和半场模式
4. 自动选择17:00-21:00时间段（会跳过已预约的时间段）
5. 填写同行人员信息
6. 完成预约和支付

## 程序文件

- **auto_reservation.py** - 主要的预约程序
- **timer.py** - 定时程序，支持多个时间点执行

## 安装依赖

```bash
pip install -r requirements.txt
```

## 配置环境变量

创建 `.env` 文件并配置以下信息：

```
LOGIN_USERNAME=你的学号
PASSWORD=你的密码
COMPANION_NAME=同行人员姓名
COMPANION_PHONE=同行人员手机号
# 多个执行时间，用逗号分隔
SCHEDULE_TIMES=05:00,07:01,09:00
```

### 配置说明

- `LOGIN_USERNAME`: 浙工大学号
- `PASSWORD`: 登录密码
- `COMPANION_NAME`: 同行人员姓名
- `COMPANION_PHONE`: 同行人员手机号
- `SCHEDULE_TIMES`: 执行时间点，支持多个时间，用逗号分隔（如：05:00,07:01,09:00）

## 使用方法

### 单次运行

```bash
python auto_reservation.py
```

### 定时运行（推荐）

```bash
python timer.py
```

#### 定时功能特点

- **多时间点支持**: 可配置多个执行时间，程序会自动等待下一个最近的时间点
- **智能调度**: 自动计算等待时间，无需手动重启
- **双重尝试**: 每个时间点会执行两次预约尝试，提高成功率
- **实时显示**: 显示当前时间、下一个执行时间和剩余等待时间
- **进度更新**: 每10分钟更新一次等待信息

#### 运行示例

```
定时程序已启动，配置的执行时间: 05:00, 07:01, 09:00
注意：请在环境变量SCHEDULE_TIMES中配置多个时间，用逗号分隔，例如: 05:00,07:00,09:00
当前时间: 2025-08-08 14:26:11
下一个执行时间: 2025-08-09 05:00:00
等待时间: 14小时 33分钟 48秒
```



## 停止程序

按 `Ctrl+C` 停止定时程序

## 注意事项

### 基本使用

1. 程序会自动截图保存关键步骤
2. 如果某个时间段已被预约，程序会自动跳过
3. 程序运行完成后会自动关闭浏览器（定时模式）
4. 请确保网络连接正常

### 定时功能

5. 定时程序需要保持运行状态才能在指定时间执行
6. 建议在电脑不关机的情况下使用定时功能
7. 如果预约脚本执行失败，程序会继续等待下一个执行时间
8. 支持配置多个时间点，程序会智能选择下一个最近的时间
9. 每个时间点会执行两次预约尝试，间隔5秒

### 最佳实践

10. 建议设置多个时间点以提高预约成功率（如：05:00,07:00,09:00）
11. 避免设置过于密集的时间点，建议间隔至少1小时
12. 程序会在每个时间点前10秒内开始执行，确保准时性
13. 如需修改时间配置，直接编辑.env文件中的SCHEDULE_TIMES即可

## 文件结构

```
├── README.md              # 使用说明
├── auto_reservation.py    # 主要预约程序
├── timer.py              # 定时程序（支持多时间点）
├── requirements.txt      # 依赖包列表
└── .env                  # 环境变量配置（需要自己创建）
```

## 常见问题

### Q: 如何设置多个执行时间？
A: 在.env文件中设置 `SCHEDULE_TIMES=05:00,07:01,09:00`，用逗号分隔多个时间。

### Q: 程序会在什么时候执行预约？
A: 程序会自动计算并等待下一个最近的时间点，在该时间点前10秒内开始执行。

### Q: 如果某个时间点预约失败怎么办？
A: 程序会在每个时间点执行两次尝试，如果都失败，会继续等待下一个时间点。

### Q: 可以在程序运行时修改时间配置吗？
A: 需要重启程序才能生效。建议停止程序（Ctrl+C），修改.env文件后重新运行。

### Q: 程序支持哪些场馆？
A: 目前只支持屏峰校区室外网球场，时间段为17:00-21:00。

## 技术说明

- 使用 Playwright 进行浏览器自动化
- 支持异步执行，避免阻塞
- 使用 subprocess 运行预约脚本，避免 Playwright 同步API冲突
- 智能时间调度算法，自动选择下一个执行时间